!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("mithril/stream")):"function"==typeof define&&define.amd?define(["exports","mithril/stream"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).glissando={},t.Stream)}(this,(function(t,e){"use strict";function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=n(e);const a=t=>e=>{const{newIndex:n,shouldUpdate:i}=((t,e)=>{if(void 0===e||Number.isNaN(e))return{newIndex:t.index,shouldUpdate:!1};const n=Math.min(e,t.count-1);return{newIndex:n,shouldUpdate:n>=0&&n<t.count&&n!==t.index}})(t,e.index);return i?Object.assign(Object.assign(Object.assign({},t),e.animate?void 0:{index:n}),{targetIndex:n,isAnimating:!!e.animate}):t},s=t=>e=>{if(!t.locations||!t.location)return;const n=t.locations.indexOf(t.location);return-1!==n?t.locations[e(n)]:void 0};t.GlissandoModel=(t={})=>{const e={initialState:(({index:t=0,count:e=0,sideViews:n=1,location:i,locations:a}={})=>{const s=[...Array(1+2*n)].map(((t,e)=>e-n)),o=Object.assign(Object.assign(Object.assign({targetIndex:t,index:t,count:e},Array.isArray(a)?{locations:a,count:a?a.length:0,location:a[0]}:void 0),i?{location:i,index:Array.isArray(a)&&a.indexOf(i)||t}:void 0),{isAnimating:!1,direction:"ltr",slots:s,sideViews:n});return o.targetIndex=o.index,o})(t),actions:t=>({previous:({animate:e}={animate:!0})=>{t((t=>a(t)({index:t.index-1,animate:!1!==e})))},next:({animate:e}={animate:!0})=>{t((t=>a(t)({index:t.index+1,animate:!1!==e})))},goTo:({index:e,location:n,animate:i})=>{t((t=>{if(n){const e={location:n,animate:i};return(t=>e=>{if(!t.locations||0===t.locations.length)return t;let n=e.location.toString(),i=t.locations.indexOf(n);-1===i&&(i=0,n=t.locations[i]);const s=void 0!==t.location&&!1!==e.animate,o=Object.assign(Object.assign({},t),{location:n}),r={index:i,animate:s};return a(o)(r)})(t)(e)}if(void 0===e)return t;const s={index:e,animate:i};return a(t)(s)}))},finalize:e=>{t((t=>a(t)({index:e,animate:!1})))},setCount:e=>{t((t=>a(Object.assign(Object.assign({},t),{count:e}))({index:t.index})))},setDirection:e=>{t((t=>Object.assign(Object.assign({},t),{direction:e})))},setLocations:e=>{t((t=>Object.assign(Object.assign({},t),{locations:e,count:e.length})))}}),selectors:t=>({hasNext:()=>{const e=t();return e.index<e.count-1},hasPrevious:()=>t().index>0,isAnimating:()=>t().isAnimating,getViewIndices:()=>{const e=t();return e.slots.map((t=>{let n=t+e.index+0;return t<0&&e.targetIndex<e.index?n=t+e.targetIndex+1:t>0&&e.targetIndex>e.index&&(n=t+e.targetIndex-1),n}))},getLocation:()=>{const e=t();return s(e)((t=>t))},getNextLocation:()=>{const e=t();return s(e)((t=>t+1))},getPreviousLocation:()=>{const e=t();return s(e)((t=>t-1))}})},n=i.default(),o=i.default.scan(((t,e)=>e(t)),Object.assign({},e.initialState),n),r=Object.assign({},e.actions(n)),c=Object.assign({},e.selectors(o)),d=i.default.scan(((t,e)=>JSON.stringify(t,null,2)===JSON.stringify(e,null,2)?i.default.SKIP:e),i.default.SKIP,o),l=i.default.lift((t=>t),d);return Object.assign(Object.assign({getState:o,getChanges:l},r),c)},t.getSliderStyle=t=>{const e=2*t.sideViews+1,n=100/e,i="rtl"===t.direction?1:-1;let a=i*n*(t.sideViews+0);t.targetIndex>t.index?a=i*n*(t.sideViews+1):t.targetIndex<t.index&&(a=i*n*(t.sideViews-1));return{style:Object.assign({width:`calc(${e} * calc(100%))`,transform:`translateX(${a}%)`},t.isAnimating?void 0:{transitionDuration:"0ms"}),className:t.isAnimating?"glissando-animating":""}},Object.defineProperty(t,"__esModule",{value:!0})}));
