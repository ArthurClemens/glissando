{"version":3,"file":"glissando-mithril.js","sources":["../src/GlissandoSlider.ts","../src/useGlissandoModel.ts"],"sourcesContent":["import { getSliderStyle, Glissando } from 'glissando';\nimport m, { ClosureComponent } from 'mithril';\n\ninterface Attrs {\n  model: Glissando.Model;\n  location?: string;\n  locations?: string[];\n  className?: string;\n}\n\ntype TGlissandoSlider = ClosureComponent<Attrs>;\n\nexport const GlissandoSlider: TGlissandoSlider = initialVnode => {\n  const { model } = initialVnode.attrs;\n  const {\n    getState,\n    finalize,\n    setCount,\n    setDirection,\n    getViewIndices,\n    goTo,\n    setLocations,\n  } = model;\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const onTransitionEnd = (evt: Event) => {\n    finalize(getState().targetIndex);\n  };\n\n  return {\n    onupdate: ({ dom, children, attrs }) => {\n      const { locations, location } = attrs;\n\n      // Children count\n      const count = (children as m.ChildArray).length;\n      if (count !== getState().count) {\n        setCount(count);\n      }\n\n      // Locations\n      if (\n        locations &&\n        JSON.stringify(locations) !== JSON.stringify(getState().locations)\n      ) {\n        setLocations(locations);\n      }\n\n      // Location\n      if (location && location !== getState().location) {\n        goTo({ location });\n      }\n\n      // Reading direction\n      const { direction } = getComputedStyle(dom);\n      if (direction !== getState().direction) {\n        setDirection(direction as Glissando.Direction);\n      }\n    },\n    view: ({ children, attrs }) => {\n      if (!children) {\n        return null;\n      }\n      const { className: sliderClassName } = attrs;\n      const { className, style } = getSliderStyle(getState());\n\n      return m(\n        'div',\n        {\n          className: ['glissando', sliderClassName].join(' '),\n        },\n        m(\n          '.glissando-slider',\n          {\n            oncreate: (vnode: m.VnodeDOM) => {\n              vnode.dom.addEventListener('transitionend', onTransitionEnd);\n            },\n            onremove: (vnode: m.VnodeDOM) => {\n              vnode.dom.removeEventListener('transitionend', onTransitionEnd);\n            },\n            className,\n            style,\n          },\n          getViewIndices().map(viewIndex =>\n            m('.glissando-page', (children as m.ChildArray)[viewIndex]),\n          ),\n        ),\n      );\n    },\n  };\n};\n","import { Glissando, GlissandoModel } from 'glissando';\nimport m from 'mithril';\n\n/**\n * Wrapper around GlissandoModel that subscribes to changes and causes Mithril to redraw on each change.\n */\nexport const useGlissandoModel = (initialState?: Glissando.InitialState) => {\n  const model = GlissandoModel(initialState);\n\n  // Subscribe to changes\n  model.getState.map(m.redraw);\n\n  return model;\n};\n"],"names":["initialVnode","model","attrs","getState","finalize","setCount","setDirection","getViewIndices","goTo","setLocations","onTransitionEnd","evt","targetIndex","onupdate","_a","dom","children","locations","location","count","length","JSON","stringify","direction","getComputedStyle","view","sliderClassName","_b","getSliderStyle","className","style","m","join","oncreate","vnode","addEventListener","onremove","removeEventListener","map","viewIndex","initialState","GlissandoModel","redraw"],"mappings":"mnBAYiD,SAAAA,GACvC,IAAAC,EAAUD,EAAaE,YAE7BC,EAOEF,WANFG,EAMEH,WALFI,EAKEJ,WAJFK,EAIEL,eAHFM,EAGEN,iBAFFO,EAEEP,OADFQ,EACER,eAGES,EAAkB,SAACC,GACvBP,EAASD,IAAWS,cAGtB,MAAO,CACLC,SAAU,SAACC,OAAEC,QAAKC,aAAUd,UAClBe,EAAwBf,YAAbgB,EAAahB,WAG1BiB,EAASH,EAA0BI,OACrCD,IAAUhB,IAAWgB,OACvBd,EAASc,GAKTF,GACAI,KAAKC,UAAUL,KAAeI,KAAKC,UAAUnB,IAAWc,YAExDR,EAAaQ,GAIXC,GAAYA,IAAaf,IAAWe,UACtCV,EAAK,CAAEU,aAID,IAAAK,EAAcC,iBAAiBT,aACnCQ,IAAcpB,IAAWoB,WAC3BjB,EAAaiB,IAGjBE,KAAM,SAACX,OAAEE,aAAUd,UACjB,IAAKc,EACH,OAAO,KAED,IAAWU,EAAoBxB,YACjCyB,EAAuBC,iBAAezB,KAApC0B,cAAWC,UAEnB,OAAOC,UACL,MACA,CACEF,UAAW,CAAC,YAAaH,GAAiBM,KAAK,MAEjDD,UACE,oBACA,CACEE,SAAU,SAACC,GACTA,EAAMnB,IAAIoB,iBAAiB,gBAAiBzB,IAE9C0B,SAAU,SAACF,GACTA,EAAMnB,IAAIsB,oBAAoB,gBAAiB3B,IAEjDmB,YACAC,SAEFvB,IAAiB+B,KAAI,SAAAC,GACnB,OAAAR,UAAE,kBAAoBf,EAA0BuB,gCC7E3B,SAACC,GAChC,IAAMvC,EAAQwC,iBAAeD,GAK7B,OAFAvC,EAAME,SAASmC,IAAIP,UAAEW,QAEdzC"}