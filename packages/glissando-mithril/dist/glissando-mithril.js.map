{"version":3,"file":"glissando-mithril.js","sources":["../src/GlissandoSlider.ts","../src/useGlissandoModel.ts"],"sourcesContent":["import { getSliderStyle, Glissando } from 'glissando';\nimport m, { ClosureComponent } from 'mithril';\n\ninterface Attrs {\n  model: Glissando.Model;\n  location?: string;\n  locations?: string[];\n  className?: string;\n}\n\ntype TGlissandoSlider = ClosureComponent<Attrs>;\n\nexport const GlissandoSlider: TGlissandoSlider = initialVnode => {\n  const { model } = initialVnode.attrs;\n  const {\n    getState,\n    finalize,\n    setCount,\n    setDirection,\n    getViewIndices,\n    goTo,\n    setLocations,\n  } = model;\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const onTransitionEnd = (evt: Event) => {\n    finalize(getState().targetIndex);\n  };\n\n  return {\n    onupdate: ({ dom, children, attrs }) => {\n      const { locations, location } = attrs;\n\n      // Children count\n      const count = (children as m.ChildArray).length;\n      if (count !== getState().count) {\n        setCount(count);\n      }\n\n      // Locations\n      if (\n        locations &&\n        JSON.stringify(locations) !== JSON.stringify(getState().locations)\n      ) {\n        setLocations(locations);\n      }\n\n      // Location\n      if (location && location !== getState().location) {\n        goTo({ location });\n      }\n\n      // Reading direction\n      const { direction } = getComputedStyle(dom);\n      if (direction !== getState().direction) {\n        setDirection(direction as Glissando.Direction);\n      }\n    },\n    view: ({ children, attrs }) => {\n      if (!children) {\n        return null;\n      }\n      const { className: sliderClassName } = attrs;\n      const { className, style } = getSliderStyle(getState());\n\n      return m(\n        'div',\n        {\n          className: ['glissando', sliderClassName].join(' '),\n        },\n        m(\n          '.glissando-slider',\n          {\n            oncreate: (vnode: m.VnodeDOM) => {\n              vnode.dom.addEventListener('transitionend', onTransitionEnd);\n            },\n            onremove: (vnode: m.VnodeDOM) => {\n              vnode.dom.removeEventListener('transitionend', onTransitionEnd);\n            },\n            className,\n            style,\n          },\n          getViewIndices().map(viewIndex =>\n            m('.glissando-page', (children as m.ChildArray)[viewIndex]),\n          ),\n        ),\n      );\n    },\n  };\n};\n","import { Glissando, GlissandoModel } from 'glissando';\nimport m from 'mithril';\n\n/**\n * Wrapper around GlissandoModel that subscribes to changes and causes Mithril to redraw on each change.\n */\nexport const useGlissandoModel = (initialState?: Glissando.InitialState) => {\n  const model = GlissandoModel(initialState);\n\n  // Subscribe to changes\n  model.getState.map(m.redraw);\n\n  return model;\n};\n"],"names":["initialVnode","model","attrs","getState","finalize","setCount","setDirection","getViewIndices","goTo","setLocations","onTransitionEnd","evt","targetIndex","onupdate","dom","children","locations","location","count","length","JSON","stringify","direction","getComputedStyle","view","className","sliderClassName","style","getSliderStyle","m","join","oncreate","vnode","addEventListener","onremove","removeEventListener","map","viewIndex","initialState","GlissandoModel","redraw"],"mappings":"mnBAYiDA,IAC/C,MAAMC,MAAEA,GAAUD,EAAaE,OACzBC,SACJA,EAAQC,SACRA,EAAQC,SACRA,EAAQC,aACRA,EAAYC,eACZA,EAAcC,KACdA,EAAIC,aACJA,GACER,EAGES,EAAmBC,IACvBP,EAASD,IAAWS,cAGtB,MAAO,CACLC,SAAU,EAAGC,IAAAA,EAAKC,SAAAA,EAAUb,MAAAA,MAC1B,MAAMc,UAAEA,EAASC,SAAEA,GAAaf,EAG1BgB,EAASH,EAA0BI,OACrCD,IAAUf,IAAWe,OACvBb,EAASa,GAKTF,GACAI,KAAKC,UAAUL,KAAeI,KAAKC,UAAUlB,IAAWa,YAExDP,EAAaO,GAIXC,GAAYA,IAAad,IAAWc,UACtCT,EAAK,CAAES,SAAAA,IAIT,MAAMK,UAAEA,GAAcC,iBAAiBT,GACnCQ,IAAcnB,IAAWmB,WAC3BhB,EAAagB,IAGjBE,KAAM,EAAGT,SAAAA,EAAUb,MAAAA,MACjB,IAAKa,EACH,OAAO,KAET,MAAQU,UAAWC,GAAoBxB,GACjCuB,UAAEA,EAASE,MAAEA,GAAUC,iBAAezB,KAE5C,OAAO0B,UACL,MACA,CACEJ,UAAW,CAAC,YAAaC,GAAiBI,KAAK,MAEjDD,UACE,oBACA,CACEE,SAAWC,IACTA,EAAMlB,IAAImB,iBAAiB,gBAAiBvB,IAE9CwB,SAAWF,IACTA,EAAMlB,IAAIqB,oBAAoB,gBAAiBzB,IAEjDe,UAAAA,EACAE,MAAAA,GAEFpB,IAAiB6B,KAAIC,GACnBR,UAAE,kBAAoBd,EAA0BsB,+BC7E1BC,IAChC,MAAMrC,EAAQsC,iBAAeD,GAK7B,OAFArC,EAAME,SAASiC,IAAIP,UAAEW,QAEdvC"}